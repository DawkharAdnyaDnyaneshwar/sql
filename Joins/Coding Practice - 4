<!-- In this practice set, let's get the hold of SQL Joins operations using the following database.

Database:
The database given is similar to IMDb, which consists data related to various movies, directors and actors.


The database is designed to cover the below business requirements.
- A movie can have more than one actor casted and vice versa.
- A movie can have more than one director and vice versa.

Note
You can assume that actors in the database have acted in at least one movie (in the database), where as some directors might not have the movies they directed(in the given database). So, do take care of this detail while writing various queries on the database, especially, when deciding on INNER JOIN / LEFT JOIN.
Junction Tables
movie_cast is a junction table which stores the many-to-many relationship betweenmovieandactor. Androleof anactorfor amovieis stored in the table. Similarlymovie_directortable stores the many-to-many relationship betweenmovieanddirector

Refer the tables in the code playground for a better understanding of the database. -->

<!-- Questions -->
<!-- 1.
For all the movies, get the actor_ids of the cast.

Note:
Sort the output in the ascending order of movie_name, and then in the ascending order of the actor_id.
Expected Output Format
movie_name	actor_id
...	        ... -->

SELECT
  movie.name AS movie_name,
  movie_cast.actor_id
FROM
  movie
  INNER JOIN movie_cast ON movie.id = movie_cast.movie_id
ORDER BY
  movie_name ASC,
  actor_id ASC;

<!-- 2.
Get the number of movies in which "Daniel Radcliffe" has acted.

Expected Output Format
no_of_movies
... -->

SELECT
  COUNT(movie_cast.movie_id) AS no_of_movies
FROM
  movie_cast
  INNER JOIN actor ON movie_cast.actor_id = actor.id
WHERE
  actor.name = "Daniel Radcliffe";

<!-- 3.
For each actor, get the number of movies in which they are casted. 

Note:
Sort the output in the ascending order of the actor_name.
Expected Output Format
actor_name	no_of_movies
...	        ... -->

SELECT
  actor.name AS actor_name,
  COUNT(movie_cast.movie_id) AS no_of_movies
FROM
  actor
  INNER JOIN movie_cast ON actor.id = movie_cast.actor_id
GROUP BY
  actor.id
ORDER BY
  actor_name ASC;

<!-- 4.
Get the actors who acted in at least 5 movies.

Note:
Sort the output in the ascending order of the actor_name.
Expected Output Format
actor_name	no_of_movies
...	        ... -->

SELECT
  actor.name AS actor_name,
  COUNT(movie_cast.movie_id) AS no_of_movies
FROM
  actor
  INNER JOIN movie_cast ON actor.id = movie_cast.actor_id
GROUP BY
  actor.id
HAVING
  no_of_movies >= 5
ORDER BY
  actor_name ASC;

<!-- 5.
For each director in the database, get the number of movies they have directed.

Note:
If a director did not direct any movie (in the database), consider the count as 0.
Sort the output in descending order of no_of_movies, and then in the ascending order of director_name.
Expected Output Format
director_name	no_of_movies
...	            ... -->

SELECT
  director.name AS director_name,
  COUNT(movie_director.movie_id) AS no_of_movies
FROM
  director
  LEFT JOIN movie_director ON director.id = movie_director.director_id
GROUP BY
  director.id
ORDER BY
  no_of_movies DESC,
  director_name ASC;

<!-- 6.
Get all the ids of directors who directed at least two movies, with rating greater than 6

Sort the output in descending order of no_of_movies, and then in the ascending order of director_id

Expected Output Format
director_id	no_of_movies
...	        ... -->

SELECT
  movie_director.director_id,
  COUNT(movie_director.movie_id) AS no_of_movies
FROM
  movie_director
  INNER JOIN movie ON movie_director.movie_id = movie.id
WHERE
  movie.rating > 6
GROUP BY
  movie_director.director_id
HAVING
  no_of_movies >= 2
ORDER BY
  no_of_movies DESC,
  movie_director.director_id ASC;

<!-- 7.
Get all the director_ids who directed at least two movies that have a profit at least 50 crores.

Note:
Profit is the difference between collection and budget of movies
Sort the output in the descending order ofno_of_movies_with_atleast_profit_50_crand then in the ascending order ofdirector_id.
Expected Output Format
director_id	no_of_movies_with_atleast_profit_50_cr
...	        ... -->

SELECT
  movie_director.director_id,
  COUNT(movie.id) AS no_of_movies_with_atleast_profit_50_cr
FROM
  movie
  INNER JOIN movie_director ON movie.id = movie_director.movie_id
WHERE
  (collection_in_cr - budget_in_cr) >= 50
GROUP BY
  movie_director.director_id
HAVING
  COUNT(movie.id) >= 2
ORDER BY
  no_of_movies_with_atleast_profit_50_cr DESC,
  director_id ASC;

<!-- 8.
Get all the director_ids who directed at least two movies and have an average profit greater than 50 crores.

Note:
Profit is the difference between collection and budget of movies
Sort the output in the descending order ofno_of_moviesand then in the ascending order ofdirector_id.
Expected Output Format
director_id	no_of_movies	avg_profit
...	        ...	            ... -->

SELECT
  movie_director.director_id,
  COUNT(movie.id) AS no_of_movies,
  AVG((collection_in_cr - budget_in_cr)) AS avg_profit
FROM
  movie
  INNER JOIN movie_director ON movie.id = movie_director.movie_id
GROUP BY
  movie_director.director_id
HAVING
  COUNT(movie.id) >= 2
  AND avg_profit >= 50
ORDER BY
  no_of_movies DESC,
  director_id ASC;

<!-- 9.
Fetch the directors who directed at least two movies, and has an average rating (for all his/her movies) greater than 8

Note
Sort the output in descending order of no_of_movies, and then in the ascending order of director_id
Expected Output Format
director_id	no_of_movies	avg_rating
...	        ...	            ... -->

SELECT
  movie_director.director_id,
  COUNT(movie.id) AS no_of_movies,
  AVG(movie.rating) AS avg_rating
FROM
  movie
  INNER JOIN movie_director ON movie.id = movie_director.movie_id
GROUP BY
  movie_director.director_id
HAVING
  no_of_movies >= 2
  AND avg_rating > 8
ORDER BY
  no_of_movies DESC,
  movie_director.director_id ASC;

<!-- 10.
Get all the distinct actors who casted in any of the Harry Potter movies.

Note:
Consider the movie names that contain "Harry Potter ".
Sort the output in the ascending order of the actor_name.
Expected Output Format
actor_name
... -->

SELECT
  DISTINCT actor.name AS actor_name
FROM
  (
    actor
    INNER JOIN movie_cast ON actor.id = movie_cast.actor_id
  )
  INNER JOIN movie ON movie_cast.movie_id = movie.id
WHERE
  movie.name LIKE "%Harry Potter%"
ORDER BY
  actor_name ASC;

<!-- 11.
Get all the distinct directors who directed any of the Harry Potter movies.

Note:
Consider the movie names that contain "Harry Potter ".
Sort the output in the ascending order of the director_name.
director_name
... -->

SELECT
  DISTINCT(director.name) AS director_name
FROM
  (
    director
    INNER JOIN movie_director ON director.id = movie_director.director_id
  )
  INNER JOIN movie ON movie_director.movie_id = movie.id
WHERE
  movie.name LIKE "%Harry Potter%"
ORDER BY
  director_name ASC;